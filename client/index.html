<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Artists - YTMusic</title>

    {{meta}}{{tabler}}
  </head>
  <body>
    {{navbar}}

    <div class="page-body container-fluid text-center">
      <h1>Artists</h1>
      <div class="input-icon mt-3 mb-2">
        <span class="input-icon-addon ti ti-search"></span>
        <input type="text" class="form-control" placeholder="Search by Name" id="name-input" />
      </div>
      <div id="artists" class="row row-cards" data-masonry='{"percentPosition": true }'></div>
    </div>

    <style>
      #artist-modal {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }
    </style>
    <script>
      let artists = document.getElementById("artists");

      function openArtist(a) {
        let old = document.getElementById("artist-modal");
        if (old) old.remove();

        let modal = document.createElement("span");
        modal.id = "artist-modal";
        modal.innerHTML = `{{artist-open}}`;
        let styles = {position: "absolute", top: "0px", left: "0px", width: "100%", height: "100%", backgroundColor: "rgba(0,0,0,0.5)"}
        Object.keys(styles).forEach(s => {
          modal.style[s] = styles[s];
        });
        document.body.appendChild(modal);
      }

      fetch(`/api/artists/all`)
        .then((res) => res.json())
        .then(async (res) => {
          if (res.err) return;

          let artists = document.getElementById("artists");
          artists.innerHTML = "";
          res
            .sort((a, b) => {
              return a.name.toLowerCase().replace(/the /i, "") >
                b.name.toLowerCase().replace(/the /i, "")
                ? 1
                : -1;
            })
            .forEach((a) => {
              let artist = document.createElement("div");
              artist.innerHTML = `{{artist-card}}`;
              artist.classList.add("col-sm-6", "col-lg-4");
              artist.onclick = function () {
                openArtist(a);
              };
              artists.appendChild(artist);
              let hover = document.getElementById(`card-overlay-${a.id}`).querySelector("span");
              hover.className = "ti ti-settings text-indigo";
              hover.style.textShadow = "none";
            });
        })
        .catch((err) => {
          console.log("Server is down? Error: " + err);
        });
    </script>
  </body>
</html>
